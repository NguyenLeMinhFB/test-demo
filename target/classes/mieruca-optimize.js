var mierucaOptimize=function(){this.protocol="http:",this.getCombineCookie=e=>{var t=new Set;return document.cookie.split("; ").forEach((o=>{let[i,r]=o.split("=");i.startsWith(e)&&t.add(r)})),[...t].join(";")},this.getSessionIdFromCookie=e=>{for(var t=document.cookie.split("; "),o="",i=0;i<t.length;i++){let[r,n]=t[i].split("=");if(r.startsWith(e)){o=n.split("_")[1];break}}return o};var e,t,o,i=this.getCombineCookie,r=function(){window.__mieruca_optimize_queue=[],window.__mieruca_optimize.init()};this.init=()=>{e=new URL(window.location.href),t=e.searchParams,o=this.protocol,window.__mieruca_optimize_previousUrl=window.__mieruca_optimize_previousUrl||location.href,window.__mieruca_optimize_queue=window.__mieruca_optimize_queue||[];for(let e=0;e<window.__optimizeid.length;e++){let o=window.__optimizeid[e][0];if(!window.__mieruca_optimize_queue.includes(o)){if(window.__mieruca_optimize_queue.push(o),p(o),d())return;l(),n(o),t.has("_mo_ab_preview_mode")?m(o):t.has("_mo_ab_preview_pid")?a(o):c(o)}}window.__mieruca_optimize_url_change_handler||(window.__mieruca_optimize_url_change_handler=!0,moUrlChangeListener.bind(this)(r,null))};var n=t=>{let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=o+"//localhost:8080/redirect-url/embed?siteId="+moEncode(t)+"&visitorUrl="+moEncode(e.toString())+"&dv="+moEncode(s())+"&ck="+moEncode(i("__MOR-"))+"&referUrl="+moEncode(document.referrer)+"&ua="+moEncode(navigator.userAgent),moAddElementScript(r)},a=e=>{let i=t.get("dv")||s(),r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=o+"//localhost:8080/ab/preview?sId="+moEncode(e)+"&dv="+moEncode(i)+"&pId="+moEncode(t.get("_mo_ab_preview_pid")||""),moAddElementScript(r)},c=t=>{let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=o+"//localhost:8080/ab/embed?siteId="+moEncode(t)+"&visitorUrl="+moEncode(e.toString())+"&dv="+moEncode(s())+"&ck="+moEncode(i("__MOAB-"))+"&ua="+moEncode(navigator.userAgent),moAddElementScript(r)},m=i=>{const r=e,n=new URLSearchParams(r.search);n.delete("_mo_ab_preview_mode"),r.search=n.toString();let a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=o+"//localhost:8080/ab/view?sId="+moEncode(i)+"&visitorUrl="+moEncode(r.toString())+"&pId="+moEncode(t.get("_mo_ab_preview_mode")||""),moAddElementScript(a)},s=()=>{var e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"TABLET":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"MOBILE":"DESKTOP"},d=()=>{var e=navigator.userAgent;return/MierucaHeatmap|fabercompany.co.jp/.test(e)},l=()=>{if(t.has("_mo")){var o=!1;t.get("_mo").split(";_;").forEach((function(e){var[t,i]=e.split(":");if(document.cookie.split("; ").forEach((e=>{let[r,n]=e.split("=");t===r&&i===n&&(o=!0)})),!o){var r=new Date;r.setTime(r.getTime()+80352e5);var n=r.toUTCString(),a="."+window.location.host.replace("www.",""),c=moEncode(t),m=moEncode(i);document.cookie=`${c}=${m};domain=${a};expires=${n};path=/;`}})),t.delete("_mo"),e.search=t.toString()}},p=e=>{window.opener&&document.referrer&&"http://localhost:8083"===new URL(document.referrer).origin&&window.addEventListener("message",(t=>{if("http://localhost:8083"!==t.origin)return;let o=t.data;if("VISUAL_EDITOR_SCRIPT"===o.action)if("open"===o.status&&o.code===e){window.__mosCode=o.code,t.source.postMessage({action:"VISUAL_EDITOR_SCRIPT",status:"ready"},t.origin);var i=new Date;let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://dev.opt.mieru-ca.com/service/js/mieruca-optimize-ve.js?v="+i.getTime(),moAddElementScript(e)}}))}},moObserverHandler=function(e,t,o={childList:!0,subtree:!0,attributes:!0,characterData:!0}){let i=new MutationObserver(((o,i)=>{e&&e(t,o,i)}));return i.observe(document.body,o),i},moUrlChangeListener=function(e,t){moObserverHandler((function(){location.href!==window.__mieruca_optimize_previousUrl&&(window.__mieruca_optimize_previousUrl=location.href,e&&e(t))}),null,{childList:!0,subtree:!0})},moGetELByXpath=e=>document.evaluate(e,document.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,moWrap=(e,t)=>{moInsertBefore(t,e),e.appendChild(t)},moInsertAfter=(e,t)=>{e.parentNode.insertBefore(t,e.nextSibling)},moInsertBefore=(e,t)=>{e.parentNode.insertBefore(t,e)},moHashString=async e=>{try{const t=(new TextEncoder).encode(e),o=await crypto.subtle.digest("SHA-256",t),i=Array.from(new Uint8Array(o));return i.map((e=>e.toString(16).padStart(2,"0"))).join("")}catch(e){console.log(e)}},moApplyChange=async(stacks,mutations,observer)=>{try{let finalJS;for(let i=0;i<stacks.length;i++){let item=stacks[i];if("CODE"===item.type){if(item.isCompleteSetting)continue;if(item.css&&moAppendCss(item.css),item.html&&(document.body.outerHTML=item.html),item.javaScript)try{finalJS=item.javaScript}catch(e){console.log(e)}item.isCompleteSetting=!0;continue}let currentEle=moGetELByXpath(item.xpath);if(!currentEle)continue;let currentEleHtml=currentEle.outerHTML,hashData=await moHashString(currentEleHtml).then((e=>e));if(item.hash===hashData){if("MOVE"===item.type||"DUPLICATE"===item.type){let e=moGetELByXpath(item.desXpath);if(!e)continue;let t=e.outerHTML,o=await moHashString(t).then((e=>e));if(item.desHash!==o)continue}if(!item.isCompleteSetting){item.isCompleteSetting=!0;try{eval(item.script)}catch(e){console.log(e)}}}}if(finalJS&&eval(finalJS),observer){let e=stacks.filter((e=>!e.isCompleteSetting));0===e.length&&observer.disconnect()}}catch(e){console.log(e)}},moAppendCss=e=>{let t=document.getElementById("mo-visual-editor-style");if(t)t.firstChild?t.replaceChild(document.createTextNode(e),t.firstChild):t.appendChild(document.createTextNode(e));else{let t=document.createElement("style");t.type="text/css",t.id="mo-visual-editor-style",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}},moAddEventListeners=e=>{e.forEach((e=>{e.elFn().forEach((t=>{t.addEventListener("click",e.clFn)}))}))},moRemoveEventListeners=e=>{e.forEach((e=>{e.elFn().forEach((t=>{t.removeEventListener("click",e.clFn)}))}))},moEncode=e=>encodeURIComponent(e),moLinkageGoal=()=>{var e=window.__mieruca_optimize,t=window.__hmrid,o=window.__hmuid,i=e.getSessionIdFromCookie("__MOAB-");if(t&&o&&i){const r=e.protocol+"//localhost:8080/hm/record/goal?rId="+moEncode(t)+"&uId="+moEncode(o)+"&sesId="+moEncode(i);fetch(r,{method:"GET",mode:"no-cors"}).then().catch((e=>console.log(e)))}},moAddElementScript=e=>{let t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(e,t):document.head.appendChild(e)};window.__mieruca_optimize_queue=window.__mieruca_optimize_queue||[],window.__mieruca_optimize=new mierucaOptimize,window.__mieruca_optimize.init();